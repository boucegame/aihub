<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AI Assistant Hub</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap">
  <style>
    :root {
      --primary: #6366f1;
      --primary-dark: #4f46e5;
      --secondary: #f59e0b;
      --text: #1f2937;
      --text-light: #6b7280;
      --bg: #f9fafb;
      --bg-card: #ffffff;
      --border: #e5e7eb;
      --success: #10b981;
      --danger: #ef4444;
      --radius: 0.5rem;
      --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Inter', sans-serif;
    }

    body {
      background-color: var(--bg);
      color: var(--text);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 1rem;
      width: 100%;
      flex: 1;
      display: flex;
      flex-direction: column;
    }

    header {
      padding: 1.5rem 0;
      border-bottom: 1px solid var(--border);
      margin-bottom: 2rem;
    }

    .app-title {
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--primary);
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .app-title svg {
      width: 1.5rem;
      height: 1.5rem;
    }

    nav {
      display: flex;
      gap: 1rem;
      margin-top: 1.5rem;
    }

    .nav-button {
      padding: 0.75rem 1.25rem;
      background-color: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      color: var(--text);
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .nav-button:hover {
      border-color: var(--primary);
      color: var(--primary);
    }

    .nav-button.active {
      background-color: var(--primary);
      color: white;
      border-color: var(--primary);
    }

    .nav-button svg {
      width: 1.25rem;
      height: 1.25rem;
    }

    .page {
      display: none;
      animation: fadeIn 0.3s ease;
      flex: 1;
    }

    .page.active {
      display: flex;
      flex-direction: column;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .page-title {
      font-size: 1.75rem;
      font-weight: 600;
      margin-bottom: 1.5rem;
      color: var(--text);
    }

    .card {
      background-color: var(--bg-card);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 1.5rem;
      margin-bottom: 1.5rem;
    }

    .input-group {
      display: flex;
      gap: 0.5rem;
      margin-bottom: 1.5rem;
    }

    .input-field {
      flex: 1;
      padding: 0.75rem 1rem;
      border: 1px solid var(--border);
      border-radius: var(--radius);
      font-size: 1rem;
      transition: border-color 0.2s ease;
    }

    .input-field:focus {
      outline: none;
      border-color: var(--primary);
    }

    .btn {
      padding: 0.75rem 1.5rem;
      background-color: var(--primary);
      color: white;
      border: none;
      border-radius: var(--radius);
      font-weight: 500;
      cursor: pointer;
      transition: background-color 0.2s ease;
    }

    .btn:hover {
      background-color: var(--primary-dark);
    }

    .btn-secondary {
      background-color: var(--secondary);
    }

    .btn-secondary:hover {
      background-color: #d97706;
    }

    .response-area {
      background-color: var(--bg);
      border-radius: var(--radius);
      padding: 1rem;
      min-height: 200px;
      max-height: 500px;
      overflow-y: auto;
      white-space: pre-wrap;
      line-height: 1.5;
    }

    /* Checklist specific styles */
    .checklist-container {
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }

    .checklist-item {
      display: flex;
      align-items: center;
      padding: 0.75rem;
      background-color: var(--bg-card);
      border-radius: var(--radius);
      border: 1px solid var(--border);
      cursor: move;
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }

    .checklist-item:hover {
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .checklist-item.dragging {
      opacity: 0.5;
      transform: scale(1.02);
    }

    .checklist-item.completed {
      background-color: #f0fdf4;
      border-color: #86efac;
    }

    .checklist-item.completed .checklist-text {
      text-decoration: line-through;
      color: var(--text-light);
    }

    .checklist-checkbox {
      margin-right: 0.75rem;
      width: 1.25rem;
      height: 1.25rem;
      border-radius: 4px;
      cursor: pointer;
    }

    .checklist-text {
      flex: 1;
      font-size: 1rem;
    }

    .checklist-actions {
      display: flex;
      gap: 0.5rem;
    }

    .checklist-expand {
      color: var(--primary);
      background: none;
      border: none;
      cursor: pointer;
      opacity: 0.7;
      transition: opacity 0.2s ease;
      display: flex;
      align-items: center;
    }

    .checklist-expand:hover {
      opacity: 1;
    }

    .checklist-delete {
      color: var(--danger);
      background: none;
      border: none;
      cursor: pointer;
      opacity: 0.7;
      transition: opacity 0.2s ease;
      display: flex;
      align-items: center;
    }

    .checklist-delete:hover {
      opacity: 1;
    }

    .checklist-delete svg, .checklist-expand svg {
      width: 1.25rem;
      height: 1.25rem;
    }

    .sub-checklist {
      margin-left: 2.5rem;
      margin-top: 0.5rem;
      display: none;
      animation: slideDown 0.3s ease;
    }

    .sub-checklist.active {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }

    @keyframes slideDown {
      from { opacity: 0; transform: translateY(-10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .sub-checklist-item {
      display: flex;
      align-items: center;
      padding: 0.5rem;
      background-color: #f3f4f6;
      border-radius: var(--radius);
      border: 1px solid var(--border);
    }

    .sub-checklist-item.completed {
      background-color: #f0fdf4;
      border-color: #86efac;
    }

    .sub-checklist-item.completed .sub-checklist-text {
      text-decoration: line-through;
      color: var(--text-light);
    }

    .sub-checklist-text {
      flex: 1;
      font-size: 0.875rem;
    }

    .sub-checklist-form {
      display: flex;
      gap: 0.5rem;
      margin-top: 0.5rem;
    }

    .sub-checklist-input {
      flex: 1;
      padding: 0.5rem 0.75rem;
      border: 1px solid var(--border);
      border-radius: var(--radius);
      font-size: 0.875rem;
    }

    .sub-checklist-add {
      padding: 0.5rem 0.75rem;
      background-color: var(--primary);
      color: white;
      border: none;
      border-radius: var(--radius);
      font-size: 0.875rem;
      cursor: pointer;
    }

    /* Chef specific styles */
    .ingredient-tags {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      margin-bottom: 1rem;
    }

    .ingredient-tag {
      background-color: #e0e7ff;
      color: var(--primary);
      padding: 0.25rem 0.75rem;
      border-radius: 9999px;
      font-size: 0.875rem;
      display: flex;
      align-items: center;
      gap: 0.25rem;
    }

    .ingredient-tag button {
      background: none;
      border: none;
      cursor: pointer;
      display: flex;
      align-items: center;
      color: var(--primary);
    }

    .recipe-card {
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 1rem;
      margin-bottom: 1rem;
    }

    .recipe-title {
      font-size: 1.25rem;
      font-weight: 600;
      margin-bottom: 0.5rem;
    }

    /* Work specific styles */
    .work-options {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
      gap: 1rem;
      margin-bottom: 1.5rem;
    }

    .work-option {
      background-color: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 1rem;
      cursor: pointer;
      transition: border-color 0.2s ease;
    }

    .work-option:hover {
      border-color: var(--primary);
    }

    .work-option.selected {
      border-color: var(--primary);
      background-color: #e0e7ff;
    }

    .work-option-title {
      font-weight: 600;
      margin-bottom: 0.5rem;
    }

    .work-option-desc {
      font-size: 0.875rem;
      color: var(--text-light);
    }

    /* Loading animation */
    .loading {
      display: none;
      align-items: center;
      justify-content: center;
      margin: 1rem 0;
    }

    .loading.active {
      display: flex;
    }

    .loading-spinner {
      width: 2rem;
      height: 2rem;
      border: 3px solid #e0e7ff;
      border-top: 3px solid var(--primary);
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    /* Responsive styles */
    @media (max-width: 768px) {
      nav {
        flex-wrap: wrap;
      }
      
      .nav-button {
        flex: 1;
        justify-content: center;
      }
      
      .input-group {
        flex-direction: column;
      }
      
      .work-options {
        grid-template-columns: 1fr;
      }
    }

    footer {
      text-align: center;
      padding: 1.5rem 0;
      color: var(--text-light);
      font-size: 0.875rem;
      border-top: 1px solid var(--border);
      margin-top: 2rem;
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div style="display: flex; align-items: center; justify-content: space-between;">
        <h1 class="app-title">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2H2v10h10V2Z"/><path d="M12 12H2v10h10V12Z"/><path d="M22 2h-10v20h10V2Z"/></svg>
          AI Assistant Hub
        </h1>
      </div>
      <nav>
        <button class="nav-button active" data-page="checklist">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="8" height="8" x="3" y="3" rx="2"/><path d="m15 9 2 2 4-4"/><rect width="8" height="8" x="3" y="13" rx="2"/><path d="m15 19 2 2 4-4"/></svg>
          Checklist
        </button>
        <button class="nav-button" data-page="chef">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M6 13.87A4 4 0 0 1 7.41 6a5.11 5.11 0 0 1 1.05-1.54 5 5 0 0 1 7.08 0A5.11 5.11 0 0 1 16.59 6 4 4 0 0 1 18 13.87V21H6Z"/><line x1="6" x2="18" y1="17" y2="17"/></svg>
          Chef
        </button>
        <button class="nav-button" data-page="work">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="20" height="14" x="2" y="7" rx="2" ry="2"/><path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"/></svg>
          Work
        </button>
      </nav>
    </header>

    <!-- Checklist Page -->
    <div id="checklist" class="page active">
      <h2 class="page-title">Smart Checklist</h2>
      <div class="card">
        <p>Ask AI to create a checklist for you. You can reorder items by dragging, mark them as complete, or delete them.</p>
        <div class="input-group">
          <input type="text" id="checklistPrompt" class="input-field" placeholder="e.g., Create a checklist for my weekend trip">
          <button id="generateChecklist" class="btn">Generate</button>
        </div>
        <div class="loading" id="checklistLoading">
          <div class="loading-spinner"></div>
        </div>
        <div class="checklist-container" id="checklistItems">
          <!-- Checklist items will be added here -->
        </div>
      </div>
    </div>

    <!-- Chef Page -->
    <div id="chef" class="page">
      <h2 class="page-title">AI Chef Assistant</h2>
      <div class="card">
        <p>Ask for recipes or what you can make with ingredients you have on hand.</p>
        <div class="input-group">
          <input type="text" id="ingredientInput" class="input-field" placeholder="Add an ingredient (e.g., chicken)">
          <button id="addIngredient" class="btn btn-secondary">Add</button>
        </div>
        <div class="ingredient-tags" id="ingredientTags">
          <!-- Ingredient tags will be added here -->
        </div>
        <div class="input-group">
          <input type="text" id="recipePrompt" class="input-field" placeholder="What would you like to cook? (optional)">
          <button id="generateRecipe" class="btn">Find Recipes</button>
        </div>
        <div class="loading" id="chefLoading">
          <div class="loading-spinner"></div>
        </div>
        <div class="response-area" id="recipeResponse">
          <!-- Recipe results will be displayed here -->
        </div>
      </div>
    </div>

    <!-- Work Page -->
    <div id="work" class="page">
      <h2 class="page-title">Work Assistant</h2>
      <div class="card">
        <p>Get help with various work-related tasks.</p>
        <div class="work-options">
          <div class="work-option" data-option="email">
            <h3 class="work-option-title">Email Writing</h3>
            <p class="work-option-desc">Draft professional emails</p>
          </div>
          <div class="work-option" data-option="summary">
            <h3 class="work-option-title">Text Summarization</h3>
            <p class="work-option-desc">Summarize long documents</p>
          </div>
          <div class="work-option" data-option="meeting">
            <h3 class="work-option-title">Meeting Notes</h3>
            <p class="work-option-desc">Structure meeting notes</p>
          </div>
          <div class="work-option" data-option="presentation">
            <h3 class="work-option-title">Presentation Outline</h3>
            <p class="work-option-desc">Create presentation structures</p>
          </div>
        </div>
        <div class="input-group">
          <textarea id="workPrompt" class="input-field" style="min-height: 120px" placeholder="Describe what you need help with..."></textarea>
        </div>
        <button id="generateWork" class="btn">Generate</button>
        <div class="loading" id="workLoading">
          <div class="loading-spinner"></div>
        </div>
        <div class="response-area" id="workResponse">
          <!-- Work results will be displayed here -->
        </div>
      </div>
    </div>

    <footer>
      <p>AI Assistant Hub Â© 2025 | Powered by Mistral AI</p>
    </footer>
  </div>

  <script>
    // Global variables
    // IMPORTANT: Replace this with your actual API key
    const apiKey = 'RLgrUT23aBehDtWnl178RBlIaXls6Ux1';
    let selectedWorkOption = '';

    // System prompts for each feature
    const SYSTEM_PROMPTS = {
      checklist: `You are a helpful assistant that creates well-organized, practical checklists. 
      Your task is to generate a checklist based on the user's request. 
      Format your response as a JSON array of checklist items. 
      Each item should be an object with a 'text' property.
      Example: [{"text": "Item 1"}, {"text": "Item 2"}]
      Keep items concise, actionable, and relevant to the user's request.
      Do not include any explanations or additional text in your response, only the JSON array.`,
      
      subChecklist: `You are a helpful assistant that creates detailed sub-items for a checklist.
      Your task is to generate 5 specific sub-items for the main checklist item provided.
      Format your response as a JSON array of checklist items.
      Each item should be an object with a 'text' property.
      Example: [{"text": "Sub-item 1"}, {"text": "Sub-item 2"}]
      Keep items concise, actionable, and directly related to the main item.
      Do not include any explanations or additional text in your response, only the JSON array.`,
      
      chef: `You are a culinary expert assistant that helps users find recipes based on ingredients they have.
      Provide detailed, easy-to-follow recipes that use the ingredients mentioned by the user.
      For each recipe, include:
      1. A descriptive title
      2. List of all ingredients with measurements
      3. Step-by-step cooking instructions
      4. Approximate cooking time
      5. Serving size
      6. Any helpful tips or variations
      If the user doesn't specify a dish type, suggest a variety of options that can be made with their ingredients.
      If the user has very few ingredients, suggest what additional ingredients would complement what they have.
      Format your response in markdown for readability.`,
      
      work: {
        email: `You are a professional email writing assistant. 
        Help the user draft clear, concise, and effective emails for business purposes.
        Consider the context, audience, and purpose of the email.
        Format your response with a Subject line and Body.
        Maintain a professional tone appropriate to the situation.
        Suggest appropriate greetings and closings.`,
        
        summary: `You are a text summarization expert.
        Your task is to condense long documents or texts into clear, concise summaries while preserving the key information.
        Identify and include the main points, important details, and conclusions.
        Organize the summary in a logical structure with headings if appropriate.
        Aim for approximately 20% of the original length unless otherwise specified.`,
        
        meeting: `You are a meeting notes specialist.
        Help organize and structure meeting notes in a clear, actionable format.
        Include sections for:
        1. Meeting details (date, participants, purpose)
        2. Key discussion points
        3. Decisions made
        4. Action items with assignees and deadlines
        5. Next steps
        Format the notes in a professional, easy-to-scan layout.`,
        
        presentation: `You are a presentation structure expert.
        Help create well-organized presentation outlines that effectively communicate information.
        Include:
        1. An engaging introduction
        2. Logically sequenced main points
        3. Supporting details for each point
        4. A compelling conclusion
        5. Suggestions for visual elements where appropriate
        Format the outline in a hierarchical structure that's easy to follow.`
      }
    };

    // DOM Elements
    const navButtons = document.querySelectorAll('.nav-button');
    const pages = document.querySelectorAll('.page');

    // Checklist Elements
    const checklistPrompt = document.getElementById('checklistPrompt');
    const generateChecklistButton = document.getElementById('generateChecklist');
    const checklistItems = document.getElementById('checklistItems');
    const checklistLoading = document.getElementById('checklistLoading');

    // Chef Elements
    const ingredientInput = document.getElementById('ingredientInput');
    const addIngredientButton = document.getElementById('addIngredient');
    const ingredientTags = document.getElementById('ingredientTags');
    const recipePrompt = document.getElementById('recipePrompt');
    const generateRecipeButton = document.getElementById('generateRecipe');
    const recipeResponse = document.getElementById('recipeResponse');
    const chefLoading = document.getElementById('chefLoading');

    // Work Elements
    const workOptions = document.querySelectorAll('.work-option');
    const workPrompt = document.getElementById('workPrompt');
    const generateWorkButton = document.getElementById('generateWork');
    const workResponse = document.getElementById('workResponse');
    const workLoading = document.getElementById('workLoading');

    // Navigation
    navButtons.forEach(button => {
      button.addEventListener('click', () => {
        const pageId = button.getAttribute('data-page');
        
        // Update active button
        navButtons.forEach(btn => btn.classList.remove('active'));
        button.classList.add('active');
        
        // Show active page
        pages.forEach(page => {
          if (page.id === pageId) {
            page.classList.add('active');
          } else {
            page.classList.remove('active');
          }
        });
      });
    });

    // Checklist functionality
    generateChecklistButton.addEventListener('click', generateChecklist);
    checklistPrompt.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') generateChecklist();
    });

    async function generateChecklist() {
      const prompt = checklistPrompt.value.trim();
      if (!prompt) {
        alert('Please enter a prompt for your checklist.');
        return;
      }
      
      checklistLoading.classList.add('active');
      
      try {
        const response = await fetchMistralResponse(SYSTEM_PROMPTS.checklist, prompt);
        let items;
        
        try {
          items = JSON.parse(response);
          if (!Array.isArray(items)) {
            throw new Error('Response is not an array');
          }
        } catch (e) {
          // If parsing fails, try to extract JSON from the response
          const jsonMatch = response.match(/\[.*\]/s);
          if (jsonMatch) {
            items = JSON.parse(jsonMatch[0]);
          } else {
            throw new Error('Could not parse checklist items from response');
          }
        }
        
        renderChecklistItems(items);
        checklistPrompt.value = '';
      } catch (error) {
        console.error('Error generating checklist:', error);
        alert('Failed to generate checklist. Please try again.');
      } finally {
        checklistLoading.classList.remove('active');
      }
    }

    function renderChecklistItems(items) {
      // Clear existing items if this is a new list
      if (checklistItems.children.length === 0) {
        checklistItems.innerHTML = '';
      }
      
      items.forEach(item => {
        const itemElement = document.createElement('div');
        itemElement.className = 'checklist-item';
        itemElement.draggable = true;
        
        const checkbox = document.createElement('input');
        checkbox.type = 'checkbox';
        checkbox.className = 'checklist-checkbox';
        checkbox.addEventListener('change', () => {
          if (checkbox.checked) {
            itemElement.classList.add('completed');
          } else {
            itemElement.classList.remove('completed');
          }
        });
        
        const text = document.createElement('span');
        text.className = 'checklist-text';
        text.textContent = item.text;
        
        const actionsDiv = document.createElement('div');
        actionsDiv.className = 'checklist-actions';
        
        const expandButton = document.createElement('button');
        expandButton.className = 'checklist-expand';
        expandButton.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="16"/><line x1="8" y1="12" x2="16" y2="12"/></svg>`;
        expandButton.title = "Add sub-items";
        
        const deleteButton = document.createElement('button');
        deleteButton.className = 'checklist-delete';
        deleteButton.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/></svg>`;
        deleteButton.title = "Delete item";
        
        actionsDiv.appendChild(expandButton);
        actionsDiv.appendChild(deleteButton);
        
        itemElement.appendChild(checkbox);
        itemElement.appendChild(text);
        itemElement.appendChild(actionsDiv);
        
        // Create sub-checklist container (initially hidden)
        const subChecklistContainer = document.createElement('div');
        subChecklistContainer.className = 'sub-checklist';
        
        // Add event listener for expand button
        expandButton.addEventListener('click', async () => {
          // Toggle sub-checklist visibility
          if (subChecklistContainer.classList.contains('active')) {
            subChecklistContainer.classList.remove('active');
            expandButton.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="16"/><line x1="8" y1="12" x2="16" y2="12"/></svg>`;
          } else {
            subChecklistContainer.classList.add('active');
            expandButton.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><line x1="8" y1="12" x2="16" y2="12"/></svg>`;
            
            // If sub-checklist is empty, generate sub-items
            if (subChecklistContainer.children.length === 0) {
              try {
                const response = await fetchMistralResponse(SYSTEM_PROMPTS.subChecklist, `Create 5 detailed sub-items for this checklist item: "${item.text}"`);
                let subItems;
                
                try {
                  subItems = JSON.parse(response);
                  if (!Array.isArray(subItems)) {
                    throw new Error('Response is not an array');
                  }
                } catch (e) {
                  // If parsing fails, try to extract JSON from the response
                  const jsonMatch = response.match(/\[.*\]/s);
                  if (jsonMatch) {
                    subItems = JSON.parse(jsonMatch[0]);
                  } else {
                    throw new Error('Could not parse sub-checklist items from response');
                  }
                }
                
                // Render sub-items
                subItems.forEach(subItem => {
                  const subItemElement = createSubChecklistItem(subItem.text);
                  subChecklistContainer.appendChild(subItemElement);
                });
                
                // Add form for adding custom sub-items
                const subChecklistForm = document.createElement('div');
                subChecklistForm.className = 'sub-checklist-form';
                
                const subChecklistInput = document.createElement('input');
                subChecklistInput.type = 'text';
                subChecklistInput.className = 'sub-checklist-input';
                subChecklistInput.placeholder = 'Add custom sub-item...';
                
                const subChecklistAddButton = document.createElement('button');
                subChecklistAddButton.className = 'sub-checklist-add';
                subChecklistAddButton.textContent = 'Add';
                subChecklistAddButton.addEventListener('click', () => {
                  const text = subChecklistInput.value.trim();
                  if (text) {
                    const subItemElement = createSubChecklistItem(text);
                    subChecklistContainer.insertBefore(subItemElement, subChecklistForm);
                    subChecklistInput.value = '';
                  }
                });
                
                subChecklistInput.addEventListener('keypress', (e) => {
                  if (e.key === 'Enter') {
                    const text = subChecklistInput.value.trim();
                    if (text) {
                      const subItemElement = createSubChecklistItem(text);
                      subChecklistContainer.insertBefore(subItemElement, subChecklistForm);
                      subChecklistInput.value = '';
                    }
                  }
                });
                
                subChecklistForm.appendChild(subChecklistInput);
                subChecklistForm.appendChild(subChecklistAddButton);
                subChecklistContainer.appendChild(subChecklistForm);
                
              } catch (error) {
                console.error('Error generating sub-checklist:', error);
                const errorMessage = document.createElement('p');
                errorMessage.textContent = 'Failed to generate sub-items. Please try again.';
                errorMessage.style.color = 'red';
                subChecklistContainer.appendChild(errorMessage);
              }
            }
          }
        });
        
        // Add event listener for delete button
        deleteButton.addEventListener('click', () => {
          itemElement.remove();
        });
        
        // Drag and drop functionality
        itemElement.addEventListener('dragstart', () => {
          itemElement.classList.add('dragging');
        });
        
        itemElement.addEventListener('dragend', () => {
          itemElement.classList.remove('dragging');
        });
        
        // Append the item and its sub-checklist to the container
        checklistItems.appendChild(itemElement);
        checklistItems.appendChild(subChecklistContainer);
      });
      
      // Enable drag and drop reordering
      checklistItems.addEventListener('dragover', e => {
        e.preventDefault();
        const draggingItem = document.querySelector('.dragging');
        if (!draggingItem) return;
        
        const afterElement = getDragAfterElement(checklistItems, e.clientY);
        if (afterElement) {
          checklistItems.insertBefore(draggingItem, afterElement);
        } else {
          checklistItems.appendChild(draggingItem);
        }
      });
    }

    function createSubChecklistItem(text) {
      const subItemElement = document.createElement('div');
      subItemElement.className = 'sub-checklist-item';
      
      const checkbox = document.createElement('input');
      checkbox.type = 'checkbox';
      checkbox.className = 'checklist-checkbox';
      checkbox.addEventListener('change', () => {
        if (checkbox.checked) {
          subItemElement.classList.add('completed');
        } else {
          subItemElement.classList.remove('completed');
        }
      });
      
      const subText = document.createElement('span');
      subText.className = 'sub-checklist-text';
      subText.textContent = text;
      
      const deleteButton = document.createElement('button');
      deleteButton.className = 'checklist-delete';
      deleteButton.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>`;
      deleteButton.addEventListener('click', () => {
        subItemElement.remove();
      });
      
      subItemElement.appendChild(checkbox);
      subItemElement.appendChild(subText);
      subItemElement.appendChild(deleteButton);
      
      return subItemElement;
    }

    function getDragAfterElement(container, y) {
      const draggableElements = [...container.querySelectorAll('.checklist-item:not(.dragging)')];
      
      return draggableElements.reduce((closest, child) => {
        const box = child.getBoundingClientRect();
        const offset = y - box.top - box.height / 2;
        
        if (offset < 0 && offset > closest.offset) {
          return { offset, element: child };
        } else {
          return closest;
        }
      }, { offset: Number.NEGATIVE_INFINITY }).element;
    }

    // Chef functionality
    const ingredients = [];

    addIngredientButton.addEventListener('click', addIngredient);
    ingredientInput.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') addIngredient();
    });
    
    generateRecipeButton.addEventListener('click', generateRecipe);
    recipePrompt.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') generateRecipe();
    });

    function addIngredient() {
      const ingredient = ingredientInput.value.trim();
      if (!ingredient) return;
      
      if (!ingredients.includes(ingredient)) {
        ingredients.push(ingredient);
        renderIngredientTags();
      }
      
      ingredientInput.value = '';
      ingredientInput.focus();
    }

    function renderIngredientTags() {
      ingredientTags.innerHTML = '';
      
      ingredients.forEach(ingredient => {
        const tag = document.createElement('div');
        tag.className = 'ingredient-tag';
        
        const text = document.createElement('span');
        text.textContent = ingredient;
        
        const removeButton = document.createElement('button');
        removeButton.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>`;
        removeButton.addEventListener('click', () => {
          const index = ingredients.indexOf(ingredient);
          if (index !== -1) {
            ingredients.splice(index, 1);
            renderIngredientTags();
          }
        });
        
        tag.appendChild(text);
        tag.appendChild(removeButton);
        ingredientTags.appendChild(tag);
      });
    }

    async function generateRecipe() {
      if (ingredients.length === 0) {
        alert('Please add at least one ingredient.');
        return;
      }
      
      chefLoading.classList.add('active');
      
      const prompt = recipePrompt.value.trim();
      const ingredientsList = ingredients.join(', ');
      const userPrompt = prompt 
        ? `I have these ingredients: ${ingredientsList}. I'd like to make ${prompt}.` 
        : `I have these ingredients: ${ingredientsList}. What can I make?`;
      
      try {
        const response = await fetchMistralResponse(SYSTEM_PROMPTS.chef, userPrompt);
        recipeResponse.innerHTML = markdownToHtml(response);
      } catch (error) {
        console.error('Error generating recipe:', error);
        alert('Failed to generate recipe. Please try again.');
      } finally {
        chefLoading.classList.remove('active');
      }
    }

    // Work functionality
    workOptions.forEach(option => {
      option.addEventListener('click', () => {
        workOptions.forEach(opt => opt.classList.remove('selected'));
        option.classList.add('selected');
        selectedWorkOption = option.getAttribute('data-option');
      });
    });

    generateWorkButton.addEventListener('click', generateWorkResponse);

    async function generateWorkResponse() {
      if (!selectedWorkOption) {
        alert('Please select a work option.');
        return;
      }
      
      const prompt = workPrompt.value.trim();
      if (!prompt) {
        alert('Please enter your request.');
        return;
      }
      
      workLoading.classList.add('active');
      
      try {
        const systemPrompt = SYSTEM_PROMPTS.work[selectedWorkOption];
        const response = await fetchMistralResponse(systemPrompt, prompt);
        workResponse.innerHTML = markdownToHtml(response);
      } catch (error) {
        console.error('Error generating work response:', error);
        alert('Failed to generate response. Please try again.');
      } finally {
        workLoading.classList.remove('active');
      }
    }

    // Mistral API
    async function fetchMistralResponse(systemPrompt, userPrompt) {
      const response = await fetch('https://api.mistral.ai/v1/chat/completions', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'Authorization': `Bearer ${apiKey}`
        },
        body: JSON.stringify({
          model: 'mistral-small',
          messages: [
            { role: 'system', content: systemPrompt },
            { role: 'user', content: userPrompt }
          ]
        })
      });
      
      if (!response.ok) {
        const error = await response.json();
        throw new Error(error.error?.message || 'API request failed');
      }
      
      const data = await response.json();
      return data.choices[0].message.content;
    }

    // Markdown to HTML converter
    function markdownToHtml(markdown) {
      // This is a simple markdown converter
      // Replace headers
      let html = markdown
        .replace(/^### (.*$)/gim, '<h3>$1</h3>')
        .replace(/^## (.*$)/gim, '<h2>$1</h2>')
        .replace(/^# (.*$)/gim, '<h1>$1</h1>')
        // Replace bold
        .replace(/\*\*(.*?)\*\*/gim, '<strong>$1</strong>')
        // Replace italic
        .replace(/\*(.*?)\*/gim, '<em>$1</em>')
        // Replace lists
        .replace(/^\s*\n\* (.*)/gim, '<ul>\n<li>$1</li>\n</ul>')
        .replace(/^\s*\n\d+\. (.*)/gim, '<ol>\n<li>$1</li>\n</ol>')
        // Replace code blocks
        .replace(/```([\s\S]*?)```/g, '<pre><code>$1</code></pre>')
        // Replace line breaks
        .replace(/\n/gim, '<br>');
      
      // Fix lists (combine adjacent list items)
      html = html
        .replace(/<\/ul>\s*<ul>/g, '')
        .replace(/<\/ol>\s*<ol>/g, '');
      
      return html;
    }
  </script>
</body>
</html>
